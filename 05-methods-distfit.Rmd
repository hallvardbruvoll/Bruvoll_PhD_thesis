# Methods: Distribution fitting {#methods-distfit}

## Heavy-tailed distributions, testing for power laws

-   Technical characteristics of power laws, @newman2005, do I need more?

-   Old style distribution fitting (which is used in @brown2010 and @brown2005 and check. @mitzenmacher2004, @harrison1981

-   New style presented in @clauset2009, @stumpf2012, implemented in R with the poweRlaw package @gillespie2015, and used in @strawinska-zanko2018 and @crabtree2017.

    -   Finding best x-min value for power-law iteratively with maximum likelihood estimation (the actual fitting) and KS-testing (selecting the best fit).

    -   Comparing this fit with that of other model candidates, setting the same x-min and selecting the best through AICc scores (this deviates from the procedure in @clauset2009 and @gillespie2015, but is commonly done in other contexts when comparing multiple models at once [e.g. @dauphiné2011].

The difficulty of comparing power-law models with other common candidate models (like log-normal or exponential), is that they, unlike the others, by definition need a specified lower bound above 0, denoted *x~min~*. Comparison of multiple models with AIC scores is only meaningful when done over the same range of data [this also applies to the Vuong's log-likelihood test for pairs of models proposed by @clauset2009]. However, comparing multiple models over the range in a data set which has already been recognised as providing the best possible fit for a power-law model, gives this latter model a potential advantage over the other ones. Log-normal models, for instance, can explain the entire range of a data distribution, where a power law can only explain the tail of the highest values. The fact that these two model types have frequently and for a long time represented competing explanations for the same empirical data sets, may reflect this apparent incomparability between them [@mitzenmacher2004; @harrison1981]. One can suspect then that this procedure of distribution fitting and model selection would favour power-law models unreasonably. At the same time, one of the main findings of the @clauset2009 study, was that power-law behaviour was only confirmed beyond reasonable doubt in one out of 24 empirical data sets which had been reported as power-law distributed in earlier studies, leaving the impression that the methodology would be conservative rather than lenient. In many cases however, the study remained inconclusive, especially regarding comparisons between power-law and log-normal models to empirical data sets (comparisons between power-law and other models were generally more conclusive). The authors admitted "*In general, we find that it is extremely difficult to tell the difference between log-normal and power-law behavior. Indeed, over realistic ranges of* x *the two distributions are very close, so it appears unlikely that any test would be able to tell them apart unless we had an extremely large data set*" [@clauset2009, p. 689]. Extremely large data sets are of course a luxury that is rarely afforded in archaeology, and if these two models are that close in many situations, one can ask whether picking one over the other really matters in the end. This question is further developed in Chapter \@ref(disc-methods).

REWRITE: So I decided to do a small pre-analysis, to check if synthetic log-normal distributions get power-law tails with this methodology, and under which circumstances.

First: real vs retained distribution model, with set param values (ln, exp, and pl), and different n.

(ref:05-distfit) Synthetic data series drawn from three different distribution types: exponential ($\lambda=0.125$), power-law ($\alpha=2.5$) and log-normal ($\mu=0.3$, $\sigma=2$), all with $n=100$ data points and $x_{min}=15$. Plot equivalent to Fig.5a in Clauset et al. (2009), with deviations due to random fluctuations. Scales are logarithmic, and all three series appear as straight lines, though only one is a true power law.

```{r 05-distfit, fig.cap="(ref:05-distfit)"}
load("Results/fig05_synthdist.RData")
fig05_synthdist
```

(ref:05-tails) Selected tail models for the same synthetic data sets, each with four sample sizes ($n=10^1, 10^2, 10^3, 10^4$). For each tail model, x~min~ is set at the value which gives the best power-law fit. Shade indicates fraction of data points included in the tail model. For power-law distributions, all samples are correctly identified, while this is the case only for large samples ($n>10^2$) of log-normal and exponential samples, smaller samples being interpreted as having power-law or stretched exponential tails.

```{r 05-tails, fig.cap="(ref:05-tails)"}
load("Results/fig05_type_tail.RData")
fig05_type_tail
```

(ref:05-pltails) Boxplot of all the synthetic data sets, overlaid (in red) with the data points interpreted as power-law tails. X axis is logarithmic -- note however that the log-normal distributions do not appear symmetric since they are truncated with a lower threshold.

```{r 05-pltails, fig.cap="(ref:05-pltails)"}
load("Results/fig05_synth_pl.RData")
fig05_synth_pl
```

\FloatBarrier

Second: Ln giving pl tail, fixed n and no truncation, range of meanlog and sdlog.

(ref:05-synth-ln) bla bla bla.

```{r 05-synth-ln, fig.cap="(ref:05-synth-ln)"}
load("Results/fig05_synth_ln.RData")
fig05_synth_ln
```

Next.

In his extensive review of power-law generating mechanisms, Mark Newman [-@newman2005, p. 347-8] showed algebraically how log-normal distributions can be mistaken for power laws especially when the range of the data that is being analysed is short, and when the value of \sigma is high. More specifically, since the PDF of a log-normal on log scales is a quadratic function -- i.e. a parabola -- sufficiently smaller sections of this will be nearly indistinguishable from straight lines, and can thus be well modelled as a power law. The curvature of the function is characterised by its quadratic term, which is a fraction with *x* in the numerator and \sigma in the denominator, written $-\frac{(\ln x)^2}{2\sigma^2}$, essentially causing a flatter curvature with higher values of \sigma since this term then will vary more slowly with x [see Eq. 84 in @newman2005 for more details]. This phenomenon does not seem to be apparent in the example above, possibly since the range of \sigma used here is moderate (Newman's example is with $\sigma = 10$). though we do see in Figure \@ref(fig:05-synth-ln) that higher \sigma values generate more regular curvatures rather than the abrupt curvatures caused by low values. Figures \@ref(fig:05-ln-tail) and \@ref(fig:05-ln-pl) show that power-law tails are identified -- given the methodology presented above -- in log-normal distributions with \sigma ranging from 0.5 to 3.0 and with \mu between 1.5 and 4.0, with no obvious pattern within these ranges.

```{r}
load("Results/pretest2_summary.RData")
pretest2_summary <- filter(pretest2_summary, tail == "pl") %>% 
  mutate(ntail_n = ntail/n)
```

The identified power-law tails stretch across the log-normal data in a range from `r round(min(pretest2_summary$ntail_n)*100, 3)`% (3 data points out of 1000) to `r round(max(pretest2_summary$ntail_n)*100, 3)`%.

new line

(ref:05-ln-tail) Jada jada.

```{r 05-ln-tail, fig.cap="(ref:05-ln-tail)"}
load("Results/fig05_ln_tail.RData")
fig05_ln_tail
```

Next

(ref:05-ln-pl) Tut og kjør.

```{r 05-ln-pl, fig.cap="(ref:05-ln-pl)"}
load("Results/fig05_ln_pl.RData")
fig05_ln_pl
```

End section, test so far.

\FloatBarrier

## Methodological procedure

-   Reminder of main goal for this part of the study: identify power-law structures in the house-size distributions of the Linear Pottery and Trypillia samples.

-   Synthetic data genaration:

    -   Why?

        1.  Process: how long/much does it take for a normal distribution to become power-law? And reverse sense? (multiplicative process)

        2.  Temporal resolution issue: does the temporal palimpsest of several phases with e.g. log-normal distributions produce false power-law signals? (additive process)

    -   How?

        -   Random number generation and iterated multiplicative (1.) or additive (2.) sequences, with K-S testing [@gillespie2015] at each stage. Report when the distributions become power laws.

-   Present data set with categories (settlements, quarters/neighbourhoods, time samples for Vráble)

-   Parameter settings: dist. types, xmin, testing the pl hypothesis etc. Minimal house-count cutoff (min. sample size). Isolating top house.

END chapter
